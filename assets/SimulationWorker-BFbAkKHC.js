(function(){"use strict";function fe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function $(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var V={exports:{}},Z;function ge(){return Z||(Z=1,function(i,e){(function(t){i.exports=t()})(function(){return function t(r,s,n){function o(c,l){if(!s[c]){if(!r[c]){var h=typeof $=="function"&&$;if(!l&&h)return h(c,!0);if(u)return u(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var g=s[c]={exports:{}};r[c][0].call(g.exports,function(d){var p=r[c][1][d];return o(p||d)},g,g.exports,t,r,s,n)}return s[c].exports}for(var u=typeof $=="function"&&$,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,r,s){var n,o,u,a,c,l=function(f,g){for(var d in g)h.call(g,d)&&(f[d]=g[d]);function p(){this.constructor=f}return p.prototype=g.prototype,f.prototype=new p,f.__super__=g.prototype,f},h={}.hasOwnProperty;n=t("./PriorityQueue/AbstractPriorityQueue"),o=t("./PriorityQueue/ArrayStrategy"),a=t("./PriorityQueue/BinaryHeapStrategy"),u=t("./PriorityQueue/BHeapStrategy"),c=function(f){l(g,f);function g(d){d||(d={}),d.strategy||(d.strategy=a),d.comparator||(d.comparator=function(p,b){return(p||0)-(b||0)}),g.__super__.constructor.call(this,d)}return g}(n),c.ArrayStrategy=o,c.BinaryHeapStrategy=a,c.BHeapStrategy=u,r.exports=c},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,r,s){r.exports=function(){function n(o){var u;if((o!=null?o.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((o!=null?o.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new o.strategy(o),this.length=(o!=null&&(u=o.initialValues)!=null?u.length:void 0)||0}return n.prototype.queue=function(o){this.length++,this.priv.queue(o)},n.prototype.dequeue=function(o){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},n.prototype.peek=function(o){if(!this.length)throw"Empty queue";return this.priv.peek()},n.prototype.clear=function(){return this.length=0,this.priv.clear()},n}()},{}],3:[function(t,r,s){var n;n=function(o,u,a){var c,l,h;for(l=0,c=o.length;l<c;)h=l+c>>>1,a(o[h],u)>=0?l=h+1:c=h;return l},r.exports=function(){function o(u){var a;this.options=u,this.comparator=this.options.comparator,this.data=((a=this.options.initialValues)!=null?a.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return o.prototype.queue=function(u){var a;a=n(this.data,u,this.comparator),this.data.splice(a,0,u)},o.prototype.dequeue=function(){return this.data.pop()},o.prototype.peek=function(){return this.data[this.data.length-1]},o.prototype.clear=function(){this.data.length=0},o}()},{}],4:[function(t,r,s){r.exports=function(){function n(o){var u,a,c,l,h,f,g,d;for(this.comparator=(o!=null?o.comparator:void 0)||function(p,b){return p-b},this.pageSize=(o!=null?o.pageSize:void 0)||512,this.length=0,g=0;1<<g<this.pageSize;)g+=1;if(1<<g!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=g,this._emptyMemoryPageTemplate=u=[],a=0,h=this.pageSize;0<=h?a<h:a>h;0<=h?++a:--a)u.push(null);if(this._memory=[],this._mask=this.pageSize-1,o.initialValues)for(f=o.initialValues,c=0,l=f.length;c<l;c++)d=f[c],this.queue(d)}return n.prototype.queue=function(o){this.length+=1,this._write(this.length,o),this._bubbleUp(this.length,o)},n.prototype.dequeue=function(){var o,u;return o=this._read(1),u=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,u),this._bubbleDown(1,u)),o},n.prototype.peek=function(){return this._read(1)},n.prototype.clear=function(){this.length=0,this._memory.length=0},n.prototype._write=function(o,u){var a;for(a=o>>this._shift;a>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[a][o&this._mask]=u},n.prototype._read=function(o){return this._memory[o>>this._shift][o&this._mask]},n.prototype._bubbleUp=function(o,u){var a,c,l,h;for(a=this.comparator;o>1&&(c=o&this._mask,o<this.pageSize||c>3?l=o&~this._mask|c>>1:c<2?(l=o-this.pageSize>>this._shift,l+=l&~(this._mask>>1),l|=this.pageSize>>1):l=o-2,h=this._read(l),!(a(h,u)<0));)this._write(l,u),this._write(o,h),o=l},n.prototype._bubbleDown=function(o,u){var a,c,l,h,f;for(f=this.comparator;o<this.length;)if(o>this._mask&&!(o&this._mask-1)?a=c=o+2:o&this.pageSize>>1?(a=(o&~this._mask)>>1,a|=o&this._mask>>1,a=a+1<<this._shift,c=a+1):(a=o+(o&this._mask),c=a+1),a!==c&&c<=this.length)if(l=this._read(a),h=this._read(c),f(l,u)<0&&f(l,h)<=0)this._write(a,u),this._write(o,l),o=a;else if(f(h,u)<0)this._write(c,u),this._write(o,h),o=c;else break;else if(a<=this.length)if(l=this._read(a),f(l,u)<0)this._write(a,u),this._write(o,l),o=a;else break;else break},n}()},{}],5:[function(t,r,s){r.exports=function(){function n(o){var u;this.comparator=(o!=null?o.comparator:void 0)||function(a,c){return a-c},this.length=0,this.data=((u=o.initialValues)!=null?u.slice(0):void 0)||[],this._heapify()}return n.prototype._heapify=function(){var o,u,a;if(this.data.length>0)for(o=u=1,a=this.data.length;1<=a?u<a:u>a;o=1<=a?++u:--u)this._bubbleUp(o)},n.prototype.queue=function(o){this.data.push(o),this._bubbleUp(this.data.length-1)},n.prototype.dequeue=function(){var o,u;return u=this.data[0],o=this.data.pop(),this.data.length>0&&(this.data[0]=o,this._bubbleDown(0)),u},n.prototype.peek=function(){return this.data[0]},n.prototype.clear=function(){this.length=0,this.data.length=0},n.prototype._bubbleUp=function(o){for(var u,a;o>0&&(u=o-1>>>1,this.comparator(this.data[o],this.data[u])<0);)a=this.data[u],this.data[u]=this.data[o],this.data[o]=a,o=u},n.prototype._bubbleDown=function(o){var u,a,c,l,h;for(u=this.data.length-1;a=(o<<1)+1,l=a+1,c=o,a<=u&&this.comparator(this.data[a],this.data[c])<0&&(c=a),l<=u&&this.comparator(this.data[l],this.data[c])<0&&(c=l),c!==o;)h=this.data[c],this.data[c]=this.data[o],this.data[o]=h,o=c},n}()},{}]},{},[1])(1)})}(V)),V.exports}var de=ge(),pe=fe(de);class x{constructor(e,t){if(new.target===x)throw new TypeError("Cannot instantiate abstract class BPMNObject directly");this.description=e,this.ID=t}getDescription(){return this.description}setDescription(e){this.description=e}getID(){return this.ID}setID(e){this.ID=e}toSerializableObject(){}static fromSerializableObject(e){}}class N extends x{constructor(e,t,r,s){if(new.target===N)throw new TypeError("Cannot instantiate abstract class FlowObject directly");super(e,t),this.ins=r,this.outs=s}setIns(e){this.ins=e}getIns(){return this.ins}setOuts(e){this.outs=e}getOuts(){return this.outs}toSerializableObject(){}static fromSerializableObject(e){}}class w extends N{constructor(e,t,r,s){super(e,t,r,s),this.distribution,this.mean,this.stdDeviation,this.unit,this.fixedCosts,this.resource}getUnit(){return this.unit}setUnit(e){this.unit=e}getStdDeviation(){return this.stdDeviation}setStdDeviation(e){this.stdDeviation=e}getMean(){return this.mean}setMean(e){this.mean=e}getDistribution(){return this.distribution}setDistribution(e){this.distribution=e}getFixedCosts(){return this.fixedCosts}setFixedCosts(e){this.fixedCosts=e}getResource(){return this.resource}setResource(e){this.resource=e}toSerializableObject(){return{type:"Activity",description:this.description,ID:this.ID,distribution:this.distribution,mean:this.mean,stdDeviation:this.stdDeviation,unit:this.unit,fixedCosts:this.fixedCosts,resource:this.resource,ins:this.ins.map(e=>e.getID()),outs:this.outs.map(e=>e.getID())}}static fromSerializableObject(e){const t=new w(e.description,e.ID,e.ins,e.outs);return t.distribution=e.distribution,t.mean=e.mean,t.stdDeviation=e.stdDeviation,t.unit=e.unit,t.fixedCosts=e.fixedCosts,t.resource=e.resource,t}}var me=Object.defineProperty,be=(i,e,t)=>e in i?me(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,v=(i,e,t)=>be(i,typeof e!="symbol"?e+"":e,t),z=class{},ye=class ue extends z{constructor(e){var t;super(),v(this,"_name"),v(this,"_rngFn"),this._name=(t=e.name)!=null?t:"function",this._rngFn=e}get name(){return this._name}next(){return this._rngFn()}clone(){return new ue(this._rngFn)}};function K(i){switch(typeof i){case"object":if(i instanceof z)return i;break;case"function":return new ye(i);default:return new Ee(i)}throw new Error(`invalid RNG seed or instance "${i}"`)}function ve(i,e){var t;const r=`${i}`;let s=0,n=0;for(;n<r.length;)e[255&n]=255&(s^=((t=e[255&n])!=null?t:0)*19)+r.charCodeAt(n++);return e.length?e:[0]}function J(i,e){for(let t=e.length-1;t>0;t-=1){const r=Math.floor(i.next()*(t+1)),s=e[t];e[t]=e[r],e[r]=s}}function ee(i,e,t){var r,s;const n=new Map,o=e.length-1,u=Array.from({length:t});for(let a=0;a<t;a++){const c=o-a+1,l=Math.floor(i.next()*c);u[a]=e[(r=n.get(l))!=null?r:l],n.set(l,(s=n.get(o-a))!=null?s:o-a)}return u}var Te=281474976710656,we=4503599627370496,Ie=9007199254740992,Ee=class ce extends z{constructor(e=crypto.randomUUID()){super(),v(this,"_seed"),v(this,"i"),v(this,"j"),v(this,"S"),this._seed=e;const t=ve(e,[]),r=[],s=t.length;this.i=0,this.j=0,this.S=r;let n=0;for(;n<=255;)r[n]=n++;for(let o=0,u=0;o<=255;o++){const a=r[o];u=255&u+t[o%s]+a,r[o]=r[u],r[u]=a}this.g(256)}get name(){return"arc4"}next(){let e=this.g(6),t=Te,r=0;for(;e<we;)e=(e+r)*256,t*=256,r=this.g(1);for(;e>=Ie;)e/=2,t/=2,r>>>=1;return(e+r)/t}g(e){const{S:t}=this;let{i:r,j:s}=this,n=0;for(;e--;){r=255&r+1;const o=t[r];t[s]=o,s=255&s+o,t[r]=t[s],n=n*256+t[255&t[r]+o]}return this.i=r,this.j=s,n}clone(){return new ce(this._seed)}},Oe=class le extends z{get name(){return"Math.random"}next(){return Math.random()}clone(){return new le}};function T(i){return new Se(i)}var Se=class{constructor(i){v(this,"n"),v(this,"isInt",()=>{if(Number.isInteger(this.n))return this;throw new Error(`Expected number to be an integer, got ${this.n}`)}),v(this,"isPositive",()=>{if(this.n>0)return this;throw new Error(`Expected number to be positive, got ${this.n}`)}),v(this,"lessThan",e=>{if(this.n<e)return this;throw new Error(`Expected number to be less than ${e}, got ${this.n}`)}),v(this,"greaterThanOrEqual",e=>{if(this.n>=e)return this;throw new Error(`Expected number to be greater than or equal to ${e}, got ${this.n}`)}),v(this,"greaterThan",e=>{if(this.n>e)return this;throw new Error(`Expected number to be greater than ${e}, got ${this.n}`)}),this.n=i}};function Ne(i,e=1){T(e).isInt().isPositive();const t=i.irwinHall(e);return()=>t()/e}function Ae(i,e=.5){return T(e).greaterThanOrEqual(0).lessThan(1),()=>Math.floor(i.next()+e)}function Ce(i,e=1,t=.5){return T(e).isInt().isPositive(),T(t).greaterThanOrEqual(0).lessThan(1),()=>{let r=0,s=0;for(;r++<e;)i.next()<t&&s++;return s}}function xe(i,e=1){return T(e).isPositive(),()=>-Math.log(1-i.next())/e}function Me(i,e=.5){T(e).greaterThan(0).lessThan(1);const t=1/Math.log(1-e);return()=>Math.floor(1+Math.log(i.next())*t)}function Pe(i,e=1){return T(e).isInt().greaterThanOrEqual(0),()=>{let t=0;for(let r=0;r<e;++r)t+=i.next();return t}}function _e(i,e=0,t=1){const r=i.normal(e,t);return()=>Math.exp(r())}function je(i,e=0,t=1){return()=>{let r,s,n;do r=i.next()*2-1,s=i.next()*2-1,n=r*r+s*s;while(!n||n>1);return e+t*s*Math.sqrt(-2*Math.log(n)/n)}}function ke(i,e=1){T(e).greaterThanOrEqual(0);const t=1/e;return()=>1/Math.pow(1-i.next(),t)}var De=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],Fe=i=>De[i],Re=.9189385332046727;function We(i,e=1){if(T(e).isPositive(),e<10){const t=Math.exp(-e);return()=>{let r=t,s=0,n=i.next();for(;n>r;)n=n-r,r=e*r/++s;return s}}else{const t=Math.sqrt(e),r=.931+2.53*t,s=-.059+.02483*r,n=1.1239+1.1328/(r-3.4),o=.9277-3.6224/(r-2);return()=>{for(var u;;){let a,c=i.next();if(c<=.86*o)return a=c/o-.43,Math.floor((2*s/(.5-Math.abs(a))+r)*a+e+.445);c>=o?a=i.next()-.5:(a=c/o-.93,a=(a<0?-.5:.5)-a,c=i.next()*o);const l=.5-Math.abs(a);if(l<.013&&c>l)continue;const h=Math.floor((2*s/l+r)*a+e+.445);if(c=c*n/(s/(l*l)+r),h>=10){const f=(h+.5)*Math.log(e/h)-e-Re+h-(.08333333333333333-(.002777777777777778-1/(1260*h*h))/(h*h))/h;if(Math.log(c*t)<=f)return h}else if(h>=0){const f=(u=Fe(h))!=null?u:0;if(Math.log(c)<=h*Math.log(e)-e-f)return h}}}}}function Be(i,e=0,t=1){return()=>i.next()*(t-e)+e}function $e(i){return()=>i.next()>=.5}function ze(i,e=0,t=1){return t===void 0&&(t=e===void 0?1:e,e=0),T(e).isInt(),T(t).isInt(),()=>Math.floor(i.next()*(t-e+1)+e)}function Ue(i,e,t){return T(e).greaterThan(0),T(t).greaterThan(0),()=>{const r=1-i.next();return e*Math.pow(-Math.log(r),1/t)}}var qe=class he{constructor(e=new Oe){v(this,"_rng"),v(this,"_cache",{}),this._rng=K(e)}get rng(){return this._rng}clone(e=this.rng.clone()){return new he(e)}use(e){this._rng=K(e),this._cache={}}next(){return this._rng.next()}float(e,t){return this.uniform(e,t)()}int(e,t){return this.uniformInt(e,t)()}integer(e,t){return this.uniformInt(e,t)()}bool(){return this.uniformBoolean()()}boolean(){return this.uniformBoolean()()}choice(e){if(!Array.isArray(e))throw new TypeError(`Random.choice expected input to be an array, got ${typeof e}`);const t=e.length;if(t>0){const r=this.uniformInt(0,t-1)();return e[r]}else return}sample(e,t){if(!Array.isArray(e))throw new TypeError(`Random.sample expected input to be an array, got ${typeof e}`);if(t<0||t>e.length)throw new Error(`Random.sample: k must be between 0 and array.length (${e.length}), got ${t}`);return ee(this.rng,e,t)}sampler(e,t){if(!Array.isArray(e))throw new TypeError(`Random.sampler expected input to be an array, got ${typeof e}`);if(t<0||t>e.length)throw new Error(`Random.sampler: k must be between 0 and array.length (${e.length}), got ${t}`);const r=this.rng;return()=>ee(r,e,t)}shuffle(e){if(!Array.isArray(e))throw new TypeError(`Random.shuffle expected input to be an array, got ${typeof e}`);const t=[...e];return J(this.rng,t),t}shuffler(e){if(!Array.isArray(e))throw new TypeError(`Random.shuffler expected input to be an array, got ${typeof e}`);const t=this.rng,r=[...e];return()=>(J(t,r),[...r])}uniform(e,t){return this._memoize("uniform",Be,e,t)}uniformInt(e,t){return this._memoize("uniformInt",ze,e,t)}uniformBoolean(){return this._memoize("uniformBoolean",$e)}normal(e,t){return je(this,e,t)}logNormal(e,t){return _e(this,e,t)}bernoulli(e){return Ae(this,e)}binomial(e,t){return Ce(this,e,t)}geometric(e){return Me(this,e)}poisson(e){return We(this,e)}exponential(e){return xe(this,e)}irwinHall(e){return Pe(this,e)}bates(e){return Ne(this,e)}pareto(e){return ke(this,e)}weibull(e,t){return Ue(this,e,t)}_memoize(e,t,...r){const s=`${r.join(";")}`;let n=this._cache[e];return(n===void 0||n.key!==s)&&(n={key:s,distribution:t(this,...r)},this._cache[e]=n),n.distribution}},E=new qe;class O extends N{constructor(e,t,r,s,n){super(e,t,r,s),this.type=n}getType(){return this.type}toSerializableObject(){return{type:"Event",description:this.description,ID:this.ID,eventType:this.type,ins:this.ins.map(e=>e.getID()),outs:this.outs.map(e=>e.getID())}}static fromSerializableObject(e){return new O(e.description,e.ID,e.ins,e.outs,e.eventType)}}class _ extends O{constructor(e,t,r,s,n){super(e,t,r,s,n),this.distribution,this.mean,this.stdDeviation,this.unit}getUnit(){return this.unit}setUnit(e){this.unit=e}getStdDeviation(){return this.stdDeviation}setStdDeviation(e){this.stdDeviation=e}getMean(){return this.mean}setMean(e){this.mean=e}getDistribution(){return this.distribution}setDistribution(e){this.distribution=e}toSerializableObject(){return{type:"TimerEvent",description:this.description,ID:this.ID,eventType:this.type,distribution:this.distribution,mean:this.mean,stdDeviation:this.stdDeviation,unit:this.unit,ins:this.ins.map(e=>e.getID()),outs:this.outs.map(e=>e.getID())}}static fromSerializableObject(e){const t=new _(e.description,e.ID,e.ins,e.outs,e.eventType);return t.distribution=e.distribution,t.mean=e.mean,t.stdDeviation=e.stdDeviation,t.unit=e.unit,t}}class j extends O{constructor(e,t,r,s,n){super(e,t,r,s,n),this.distribution,this.mean,this.stdDeviation,this.unit}getUnit(){return this.unit}setUnit(e){this.unit=e}getStdDeviation(){return this.stdDeviation}setStdDeviation(e){this.stdDeviation=e}getMean(){return this.mean}setMean(e){this.mean=e}getDistribution(){return this.distribution}setDistribution(e){this.distribution=e}toSerializableObject(){return{type:"MessageEvent",description:this.description,ID:this.ID,eventType:this.type,distribution:this.distribution,mean:this.mean,stdDeviation:this.stdDeviation,unit:this.unit,ins:this.ins.map(e=>e.getID()),outs:this.outs.map(e=>e.getID())}}static fromSerializableObject(e){const t=new j(e.description,e.ID,e.ins,e.outs,e.eventType);return t.distribution=e.distribution,t.mean=e.mean,t.stdDeviation=e.stdDeviation,t.unit=e.unit,t}}class H{constructor(e,t,r){this.instanceID=e,this.item=t,this.readyToBeExecuted=r,this.startTime=null,this.completedTime=null,this.executionTime,this.remainingExecutionTime,t instanceof w?(this.resourceNeeded=t.getResource(),this.generateExectuionTime()):t instanceof _||t instanceof j?(this.resourceNeeded=null,this.startTime=r,this.generateExectuionTime()):this.resourceNeeded=null}generateExectuionTime(){let e=this.item.getDistribution(),t;e==="Fixed"?t=E.uniform(this.item.getMean(),this.item.getMean()):e==="Normal"?t=E.normal(this.item.getMean(),this.item.getStdDeviation()):e==="Exponential"&&(t=E.exponential(1/this.item.getMean())),t&&(this.executionTime=Math.floor(this.convertToSeconds(this.item.getUnit(),Math.abs(t()))),this.remainingExecutionTime=this.executionTime)}getRemainingExecutionTime(){return this.remainingExecutionTime}lowerRemainingExecutionTime(){this.remainingExecutionTime-=1}convertToSeconds(e,t){switch(e.toLowerCase()){case"second":case"seconds":return t;case"minute":case"minutes":return t*60;case"hour":case"hours":return t*3600;case"day":case"days":return t*86400;case"week":case"weeks":return t*604800;default:throw new Error(`Unknown time unit: ${e}`)}}setStartTime(e){if(e>=this.readyToBeExecuted)this.startTime=e;else throw new Error(`Start time ${e} of work item: ${this.item.getID()} is greater than ready to be executed time: ${this.readyToBeExecuted}. Cannot process simulation.`)}setCompletedTime(e){if(this.startTime!==null&&e>=this.startTime)this.completedTime=e;else throw new Error(`Cannot set completed time of work item: ${this.item.getID()}: Start time is invalid or greater than completed time. Start time: ${this.startTime}, Attempted completed time: ${e}`)}getItem(){return this.item}getReadyToBeExecuted(){return this.readyToBeExecuted}getStartTime(){return this.startTime}getCompletedTime(){return this.completedTime}getResourceNeeded(){return this.resourceNeeded}getInstanceID(){return this.instanceID}getExecutionTime(){return this.executionTime}}class k extends N{constructor(e,t,r,s,n){super(e,t,s,n),this.type=r,this.probabilities=[]}getType(){return this.type}addProbability(e,t){this.probabilities.push({id:e,probability:t})}getProbabilities(){return this.probabilities}toSerializableObject(){return{type:"Gateway",description:this.description,ID:this.ID,typeGateway:this.type,probabilities:this.probabilities,ins:this.ins.map(e=>e.getID()),outs:this.outs.map(e=>e.getID())}}static fromSerializableObject(e){const t=new k(e.description,e.ID,e.typeGateway,e.ins,e.outs);return t.probabilities=e.probabilities,t}}class A extends x{constructor(e,t){super(e,t),this.cost,this.workingHours,this.number}getCost(){return this.cost}setCost(e){this.cost=e}getWorkingHours(){return this.workingHours}setWorkingHours(e){this.workingHours=e}setNumber(e){this.number=e}getNumber(){return this.number}toSerializableObject(){return{type:"Participant",description:this.description,ID:this.ID,cost:this.cost,workingHours:this.workingHours,number:this.number}}static fromSerializableObject(e){const t=new A(e.description,e.ID);return t.cost=e.cost,t.workingHours=e.workingHours,t.number=e.number,t}}class F{constructor(e,t,r,s,n){this.name=e,this.beginDay=t,this.endDay=r,this.beginTime=s,this.endTime=n}getName(){return this.name}setName(e){this.name=e}getBeginDay(){return this.beginDay}getEndDay(){return this.endDay}getBeginTime(){return this.beginTime}getEndTime(){return this.endTime}setBeginDay(e){this.beginDay=e}setEndDay(e){this.endDay=e}setBeginTime(e){this.beginTime=e}setEndTime(e){this.endTime=e}toSerializableObject(){return{name:this.name,beginDay:this.beginDay,endDay:this.endDay,beginTime:this.beginTime,endTime:this.endTime}}static fromSerializableObject(e){return new F(e.name,e.beginDay,e.endDay,e.beginTime,e.endTime)}}class I extends x{constructor(e,t,r,s,n){super(e,t),this.type=r,this.source=s,this.target=n}getType(){return this.type}getSource(){return this.source}setSource(e){this.source=e}getTarget(){return this.target}setTarget(e){this.target=e}toSerializableObject(){return{type:"ConnectingObject",description:this.description,ID:this.ID,source:this.source.getID(),target:this.target.getID(),connectionType:this.type}}static fromSerializableObject(e){return new I(e.description,e.ID,e.connectionType,e.source,e.target)}}class R extends x{constructor(e,t){super(e,t)}toSerializableObject(){return{type:"DataObject",description:this.description,ID:this.ID}}static fromSerializableObject(e){return new R(e.description,e.ID)}}function Ve(i){switch(i.type){case"Activity":return w.fromSerializableObject(i);case"Gateway":return k.fromSerializableObject(i);case"Event":return O.fromSerializableObject(i);case"MessageEvent":return j.fromSerializableObject(i);case"TimerEvent":return _.fromSerializableObject(i);case"ConnectingObject":return I.fromSerializableObject(i);case"DataObject":return R.fromSerializableObject(i);case"Participant":return A.fromSerializableObject(i);default:throw new Error(`Neznámý typ objektu: ${i.type}`)}}const te=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",He=te+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Le="["+te+"]["+He+"]*",Qe=new RegExp("^"+Le+"$");function ie(i,e){const t=[];let r=e.exec(i);for(;r;){const s=[];s.startIndex=e.lastIndex-r[0].length;const n=r.length;for(let o=0;o<n;o++)s.push(r[o]);t.push(s),r=e.exec(i)}return t}const L=function(i){const e=Qe.exec(i);return!(e===null||typeof e>"u")};function Ge(i){return typeof i<"u"}const Xe={allowBooleanAttributes:!1,unpairedTags:[]};function Ye(i,e){e=Object.assign({},Xe,e);const t=[];let r=!1,s=!1;i[0]==="\uFEFF"&&(i=i.substr(1));for(let n=0;n<i.length;n++)if(i[n]==="<"&&i[n+1]==="?"){if(n+=2,n=ne(i,n),n.err)return n}else if(i[n]==="<"){let o=n;if(n++,i[n]==="!"){n=se(i,n);continue}else{let u=!1;i[n]==="/"&&(u=!0,n++);let a="";for(;n<i.length&&i[n]!==">"&&i[n]!==" "&&i[n]!=="	"&&i[n]!==`
`&&i[n]!=="\r";n++)a+=i[n];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),n--),!nt(a)){let h;return a.trim().length===0?h="Invalid space after '<'.":h="Tag '"+a+"' is an invalid name.",m("InvalidTag",h,y(i,n))}const c=Je(i,n);if(c===!1)return m("InvalidAttr","Attributes for '"+a+"' have open quote.",y(i,n));let l=c.value;if(n=c.index,l[l.length-1]==="/"){const h=n-l.length;l=l.substring(0,l.length-1);const f=oe(l,e);if(f===!0)r=!0;else return m(f.err.code,f.err.msg,y(i,h+f.err.line))}else if(u)if(c.tagClosed){if(l.trim().length>0)return m("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",y(i,o));if(t.length===0)return m("InvalidTag","Closing tag '"+a+"' has not been opened.",y(i,o));{const h=t.pop();if(a!==h.tagName){let f=y(i,h.tagStartPos);return m("InvalidTag","Expected closing tag '"+h.tagName+"' (opened in line "+f.line+", col "+f.col+") instead of closing tag '"+a+"'.",y(i,o))}t.length==0&&(s=!0)}}else return m("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",y(i,n));else{const h=oe(l,e);if(h!==!0)return m(h.err.code,h.err.msg,y(i,n-l.length+h.err.line));if(s===!0)return m("InvalidXml","Multiple possible root nodes found.",y(i,n));e.unpairedTags.indexOf(a)!==-1||t.push({tagName:a,tagStartPos:o}),r=!0}for(n++;n<i.length;n++)if(i[n]==="<")if(i[n+1]==="!"){n++,n=se(i,n);continue}else if(i[n+1]==="?"){if(n=ne(i,++n),n.err)return n}else break;else if(i[n]==="&"){const h=it(i,n);if(h==-1)return m("InvalidChar","char '&' is not expected.",y(i,n));n=h}else if(s===!0&&!re(i[n]))return m("InvalidXml","Extra text at the end",y(i,n));i[n]==="<"&&n--}}else{if(re(i[n]))continue;return m("InvalidChar","char '"+i[n]+"' is not expected.",y(i,n))}if(r){if(t.length==1)return m("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",y(i,t[0].tagStartPos));if(t.length>0)return m("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return m("InvalidXml","Start tag expected.",1);return!0}function re(i){return i===" "||i==="	"||i===`
`||i==="\r"}function ne(i,e){const t=e;for(;e<i.length;e++)if(i[e]=="?"||i[e]==" "){const r=i.substr(t,e-t);if(e>5&&r==="xml")return m("InvalidXml","XML declaration allowed only at the start of the document.",y(i,e));if(i[e]=="?"&&i[e+1]==">"){e++;break}else continue}return e}function se(i,e){if(i.length>e+5&&i[e+1]==="-"&&i[e+2]==="-"){for(e+=3;e<i.length;e++)if(i[e]==="-"&&i[e+1]==="-"&&i[e+2]===">"){e+=2;break}}else if(i.length>e+8&&i[e+1]==="D"&&i[e+2]==="O"&&i[e+3]==="C"&&i[e+4]==="T"&&i[e+5]==="Y"&&i[e+6]==="P"&&i[e+7]==="E"){let t=1;for(e+=8;e<i.length;e++)if(i[e]==="<")t++;else if(i[e]===">"&&(t--,t===0))break}else if(i.length>e+9&&i[e+1]==="["&&i[e+2]==="C"&&i[e+3]==="D"&&i[e+4]==="A"&&i[e+5]==="T"&&i[e+6]==="A"&&i[e+7]==="["){for(e+=8;e<i.length;e++)if(i[e]==="]"&&i[e+1]==="]"&&i[e+2]===">"){e+=2;break}}return e}const Ze='"',Ke="'";function Je(i,e){let t="",r="",s=!1;for(;e<i.length;e++){if(i[e]===Ze||i[e]===Ke)r===""?r=i[e]:r!==i[e]||(r="");else if(i[e]===">"&&r===""){s=!0;break}t+=i[e]}return r!==""?!1:{value:t,index:e,tagClosed:s}}const et=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function oe(i,e){const t=ie(i,et),r={};for(let s=0;s<t.length;s++){if(t[s][1].length===0)return m("InvalidAttr","Attribute '"+t[s][2]+"' has no space in starting.",W(t[s]));if(t[s][3]!==void 0&&t[s][4]===void 0)return m("InvalidAttr","Attribute '"+t[s][2]+"' is without value.",W(t[s]));if(t[s][3]===void 0&&!e.allowBooleanAttributes)return m("InvalidAttr","boolean attribute '"+t[s][2]+"' is not allowed.",W(t[s]));const n=t[s][2];if(!rt(n))return m("InvalidAttr","Attribute '"+n+"' is an invalid name.",W(t[s]));if(!r.hasOwnProperty(n))r[n]=1;else return m("InvalidAttr","Attribute '"+n+"' is repeated.",W(t[s]))}return!0}function tt(i,e){let t=/\d/;for(i[e]==="x"&&(e++,t=/[\da-fA-F]/);e<i.length;e++){if(i[e]===";")return e;if(!i[e].match(t))break}return-1}function it(i,e){if(e++,i[e]===";")return-1;if(i[e]==="#")return e++,tt(i,e);let t=0;for(;e<i.length;e++,t++)if(!(i[e].match(/\w/)&&t<20)){if(i[e]===";")break;return-1}return e}function m(i,e,t){return{err:{code:i,msg:e,line:t.line||t,col:t.col}}}function rt(i){return L(i)}function nt(i){return L(i)}function y(i,e){const t=i.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function W(i){return i.startIndex+i[1].length}const st={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(i,e){return e},attributeValueProcessor:function(i,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(i,e,t){return i},captureMetaData:!1},ot=function(i){return Object.assign({},st,i)};let U;typeof Symbol!="function"?U="@@xmlMetadata":U=Symbol("XML Node Metadata");class M{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e,t){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),t!==void 0&&(this.child[this.child.length-1][U]={startIndex:t})}static getMetaDataSymbol(){return U}}function at(i,e){const t={};if(i[e+3]==="O"&&i[e+4]==="C"&&i[e+5]==="T"&&i[e+6]==="Y"&&i[e+7]==="P"&&i[e+8]==="E"){e=e+9;let r=1,s=!1,n=!1,o="";for(;e<i.length;e++)if(i[e]==="<"&&!n){if(s&&ft(i,e)){e+=7;let u,a;[u,a,e]=ut(i,e+1),a.indexOf("&")===-1&&(t[u]={regx:RegExp(`&${u};`,"g"),val:a})}else if(s&&gt(i,e)){e+=8;const{index:u}=lt(i,e+1);e=u}else if(s&&dt(i,e))e+=8;else if(s&&pt(i,e)){e+=9;const{index:u}=ct(i,e+1);e=u}else if(ht)n=!0;else throw new Error("Invalid DOCTYPE");r++,o=""}else if(i[e]===">"){if(n?i[e-1]==="-"&&i[e-2]==="-"&&(n=!1,r--):r--,r===0)break}else i[e]==="["?s=!0:o+=i[e];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}const C=(i,e)=>{for(;e<i.length&&/\s/.test(i[e]);)e++;return e};function ut(i,e){e=C(i,e);let t="";for(;e<i.length&&!/\s/.test(i[e])&&i[e]!=='"'&&i[e]!=="'";)t+=i[e],e++;if(Q(t),e=C(i,e),i.substring(e,e+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(i[e]==="%")throw new Error("Parameter entities are not supported");let r="";return[e,r]=q(i,e,"entity"),e--,[t,r,e]}function ct(i,e){e=C(i,e);let t="";for(;e<i.length&&!/\s/.test(i[e]);)t+=i[e],e++;Q(t),e=C(i,e);const r=i.substring(e,e+6).toUpperCase();if(r!=="SYSTEM"&&r!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${r}"`);e+=r.length,e=C(i,e);let s=null,n=null;if(r==="PUBLIC")[e,s]=q(i,e,"publicIdentifier"),e=C(i,e),(i[e]==='"'||i[e]==="'")&&([e,n]=q(i,e,"systemIdentifier"));else if(r==="SYSTEM"&&([e,n]=q(i,e,"systemIdentifier"),!n))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:t,publicIdentifier:s,systemIdentifier:n,index:--e}}function q(i,e,t){let r="";const s=i[e];if(s!=='"'&&s!=="'")throw new Error(`Expected quoted string, found "${s}"`);for(e++;e<i.length&&i[e]!==s;)r+=i[e],e++;if(i[e]!==s)throw new Error(`Unterminated ${t} value`);return e++,[e,r]}function lt(i,e){e=C(i,e);let t="";for(;e<i.length&&!/\s/.test(i[e]);)t+=i[e],e++;if(!Q(t))throw new Error(`Invalid element name: "${t}"`);if(e=C(i,e),i[e]!=="(")throw new Error(`Expected '(', found "${i[e]}"`);e++;let r="";for(;e<i.length&&i[e]!==")";)r+=i[e],e++;if(i[e]!==")")throw new Error("Unterminated content model");return{elementName:t,contentModel:r.trim(),index:e}}function ht(i,e){return i[e+1]==="!"&&i[e+2]==="-"&&i[e+3]==="-"}function ft(i,e){return i[e+1]==="!"&&i[e+2]==="E"&&i[e+3]==="N"&&i[e+4]==="T"&&i[e+5]==="I"&&i[e+6]==="T"&&i[e+7]==="Y"}function gt(i,e){return i[e+1]==="!"&&i[e+2]==="E"&&i[e+3]==="L"&&i[e+4]==="E"&&i[e+5]==="M"&&i[e+6]==="E"&&i[e+7]==="N"&&i[e+8]==="T"}function dt(i,e){return i[e+1]==="!"&&i[e+2]==="A"&&i[e+3]==="T"&&i[e+4]==="T"&&i[e+5]==="L"&&i[e+6]==="I"&&i[e+7]==="S"&&i[e+8]==="T"}function pt(i,e){return i[e+1]==="!"&&i[e+2]==="N"&&i[e+3]==="O"&&i[e+4]==="T"&&i[e+5]==="A"&&i[e+6]==="T"&&i[e+7]==="I"&&i[e+8]==="O"&&i[e+9]==="N"}function Q(i){if(L(i))return i;throw new Error(`Invalid entity name ${i}`)}const mt=/^[-+]?0x[a-fA-F0-9]+$/,bt=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,yt={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function vt(i,e={}){if(e=Object.assign({},yt,e),!i||typeof i!="string")return i;let t=i.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return i;if(i==="0")return 0;if(e.hex&&mt.test(t))return wt(t,16);if(t.search(/[eE]/)!==-1){const r=t.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(r){if(e.leadingZeros)t=(r[1]||"")+r[3];else if(!(r[2]==="0"&&r[3][0]==="."))return i;return e.eNotation?Number(t):i}else return i}else{const r=bt.exec(t);if(r){const s=r[1],n=r[2];let o=Tt(r[3]);if(!e.leadingZeros&&n.length>0&&s&&t[2]!==".")return i;if(!e.leadingZeros&&n.length>0&&!s&&t[1]!==".")return i;if(e.leadingZeros&&n===i)return 0;{const u=Number(t),a=""+u;return a.search(/[eE]/)!==-1?e.eNotation?u:i:t.indexOf(".")!==-1?a==="0"&&o===""||a===o||s&&a==="-"+o?u:i:n?o===a||s+o===a?u:i:t===a||t===s+a?u:i}}else return i}}function Tt(i){return i&&i.indexOf(".")!==-1&&(i=i.replace(/0+$/,""),i==="."?i="0":i[0]==="."?i="0"+i:i[i.length-1]==="."&&(i=i.substr(0,i.length-1))),i}function wt(i,e){if(parseInt)return parseInt(i,e);if(Number.parseInt)return Number.parseInt(i,e);if(window&&window.parseInt)return window.parseInt(i,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function It(i){return typeof i=="function"?i:Array.isArray(i)?e=>{for(const t of i)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}class Et{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,r)=>String.fromCodePoint(Number.parseInt(r,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,r)=>String.fromCodePoint(Number.parseInt(r,16))}},this.addExternalEntities=Ot,this.parseXml=xt,this.parseTextData=St,this.resolveNameSpace=Nt,this.buildAttributesMap=Ct,this.isItStopNode=jt,this.replaceEntitiesValue=Pt,this.readStopNodeData=Dt,this.saveTextToParentTag=_t,this.addChild=Mt,this.ignoreAttributesFn=It(this.options.ignoreAttributes)}}function Ot(i){const e=Object.keys(i);for(let t=0;t<e.length;t++){const r=e[t];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:i[r]}}}function St(i,e,t,r,s,n,o){if(i!==void 0&&(this.options.trimValues&&!r&&(i=i.trim()),i.length>0)){o||(i=this.replaceEntitiesValue(i));const u=this.options.tagValueProcessor(e,i,t,s,n);return u==null?i:typeof u!=typeof i||u!==i?u:this.options.trimValues?X(i,this.options.parseTagValue,this.options.numberParseOptions):i.trim()===i?X(i,this.options.parseTagValue,this.options.numberParseOptions):i}}function Nt(i){if(this.options.removeNSPrefix){const e=i.split(":"),t=i.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(i=t+e[1])}return i}const At=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Ct(i,e,t){if(this.options.ignoreAttributes!==!0&&typeof i=="string"){const r=ie(i,At),s=r.length,n={};for(let o=0;o<s;o++){const u=this.resolveNameSpace(r[o][1]);if(this.ignoreAttributesFn(u,e))continue;let a=r[o][4],c=this.options.attributeNamePrefix+u;if(u.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const l=this.options.attributeValueProcessor(u,a,e);l==null?n[c]=a:typeof l!=typeof a||l!==a?n[c]=l:n[c]=X(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[c]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=n,o}return n}}const xt=function(i){i=i.replace(/\r\n?/g,`
`);const e=new M("!xml");let t=e,r="",s="";for(let n=0;n<i.length;n++)if(i[n]==="<")if(i[n+1]==="/"){const u=P(i,">",n,"Closing Tag is not closed.");let a=i.substring(n+2,u).trim();if(this.options.removeNSPrefix){const h=a.indexOf(":");h!==-1&&(a=a.substr(h+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&(r=this.saveTextToParentTag(r,t,s));const c=s.substring(s.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let l=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(l=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=s.lastIndexOf("."),s=s.substring(0,l),t=this.tagsNodeStack.pop(),r="",n=u}else if(i[n+1]==="?"){let u=G(i,n,!1,"?>");if(!u)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,t,s),!(this.options.ignoreDeclaration&&u.tagName==="?xml"||this.options.ignorePiTags)){const a=new M(u.tagName);a.add(this.options.textNodeName,""),u.tagName!==u.tagExp&&u.attrExpPresent&&(a[":@"]=this.buildAttributesMap(u.tagExp,s,u.tagName)),this.addChild(t,a,s,n)}n=u.closeIndex+1}else if(i.substr(n+1,3)==="!--"){const u=P(i,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const a=i.substring(n+4,u-2);r=this.saveTextToParentTag(r,t,s),t.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}n=u}else if(i.substr(n+1,2)==="!D"){const u=at(i,n);this.docTypeEntities=u.entities,n=u.i}else if(i.substr(n+1,2)==="!["){const u=P(i,"]]>",n,"CDATA is not closed.")-2,a=i.substring(n+9,u);r=this.saveTextToParentTag(r,t,s);let c=this.parseTextData(a,t.tagname,s,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):t.add(this.options.textNodeName,c),n=u+2}else{let u=G(i,n,this.options.removeNSPrefix),a=u.tagName;const c=u.rawTagName;let l=u.tagExp,h=u.attrExpPresent,f=u.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&r&&t.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,t,s,!1));const g=t;g&&this.options.unpairedTags.indexOf(g.tagname)!==-1&&(t=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),a!==e.tagname&&(s+=s?"."+a:a);const d=n;if(this.isItStopNode(this.options.stopNodes,s,a)){let p="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),s=s.substr(0,s.length-1),l=a):l=l.substr(0,l.length-1),n=u.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)n=u.closeIndex;else{const S=this.readStopNodeData(i,c,f+1);if(!S)throw new Error(`Unexpected end of ${c}`);n=S.i,p=S.tagContent}const b=new M(a);a!==l&&h&&(b[":@"]=this.buildAttributesMap(l,s,a)),p&&(p=this.parseTextData(p,a,s,!0,h,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),b.add(this.options.textNodeName,p),this.addChild(t,b,s,d)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),s=s.substr(0,s.length-1),l=a):l=l.substr(0,l.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const p=new M(a);a!==l&&h&&(p[":@"]=this.buildAttributesMap(l,s,a)),this.addChild(t,p,s,d),s=s.substr(0,s.lastIndexOf("."))}else{const p=new M(a);this.tagsNodeStack.push(t),a!==l&&h&&(p[":@"]=this.buildAttributesMap(l,s,a)),this.addChild(t,p,s,d),t=p}r="",n=f}}else r+=i[n];return e.child};function Mt(i,e,t,r){this.options.captureMetaData||(r=void 0);const s=this.options.updateTag(e.tagname,t,e[":@"]);s===!1||(typeof s=="string"&&(e.tagname=s),i.addChild(e,r))}const Pt=function(i){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];i=i.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];i=i.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];i=i.replace(t.regex,t.val)}i=i.replace(this.ampEntity.regex,this.ampEntity.val)}return i};function _t(i,e,t,r){return i&&(r===void 0&&(r=e.child.length===0),i=this.parseTextData(i,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,r),i!==void 0&&i!==""&&e.add(this.options.textNodeName,i),i=""),i}function jt(i,e,t){const r="*."+t;for(const s in i){const n=i[s];if(r===n||e===n)return!0}return!1}function kt(i,e,t=">"){let r,s="";for(let n=e;n<i.length;n++){let o=i[n];if(r)o===r&&(r="");else if(o==='"'||o==="'")r=o;else if(o===t[0])if(t[1]){if(i[n+1]===t[1])return{data:s,index:n}}else return{data:s,index:n};else o==="	"&&(o=" ");s+=o}}function P(i,e,t,r){const s=i.indexOf(e,t);if(s===-1)throw new Error(r);return s+e.length-1}function G(i,e,t,r=">"){const s=kt(i,e+1,r);if(!s)return;let n=s.data;const o=s.index,u=n.search(/\s/);let a=n,c=!0;u!==-1&&(a=n.substring(0,u),n=n.substring(u+1).trimStart());const l=a;if(t){const h=a.indexOf(":");h!==-1&&(a=a.substr(h+1),c=a!==s.data.substr(h+1))}return{tagName:a,tagExp:n,closeIndex:o,attrExpPresent:c,rawTagName:l}}function Dt(i,e,t){const r=t;let s=1;for(;t<i.length;t++)if(i[t]==="<")if(i[t+1]==="/"){const n=P(i,">",t,`${e} is not closed`);if(i.substring(t+2,n).trim()===e&&(s--,s===0))return{tagContent:i.substring(r,t),i:n};t=n}else if(i[t+1]==="?")t=P(i,"?>",t+1,"StopNode is not closed.");else if(i.substr(t+1,3)==="!--")t=P(i,"-->",t+3,"StopNode is not closed.");else if(i.substr(t+1,2)==="![")t=P(i,"]]>",t,"StopNode is not closed.")-2;else{const n=G(i,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&s++,t=n.closeIndex)}}function X(i,e,t){if(e&&typeof i=="string"){const r=i.trim();return r==="true"?!0:r==="false"?!1:vt(i,t)}else return Ge(i)?i:""}const Y=M.getMetaDataSymbol();function Ft(i,e){return ae(i,e)}function ae(i,e,t){let r;const s={};for(let n=0;n<i.length;n++){const o=i[n],u=Rt(o);let a="";if(t===void 0?a=u:a=t+"."+u,u===e.textNodeName)r===void 0?r=o[u]:r+=""+o[u];else{if(u===void 0)continue;if(o[u]){let c=ae(o[u],e,a);const l=Bt(c,e);o[Y]!==void 0&&(c[Y]=o[Y]),o[":@"]?Wt(c,o[":@"],a,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),s[u]!==void 0&&s.hasOwnProperty(u)?(Array.isArray(s[u])||(s[u]=[s[u]]),s[u].push(c)):e.isArray(u,a,l)?s[u]=[c]:s[u]=c}}}return typeof r=="string"?r.length>0&&(s[e.textNodeName]=r):r!==void 0&&(s[e.textNodeName]=r),s}function Rt(i){const e=Object.keys(i);for(let t=0;t<e.length;t++){const r=e[t];if(r!==":@")return r}}function Wt(i,e,t,r){if(e){const s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){const u=s[o];r.isArray(u,t+"."+u,!0,!0)?i[u]=[e[u]]:i[u]=e[u]}}}function Bt(i,e){const{textNodeName:t}=e,r=Object.keys(i).length;return!!(r===0||r===1&&(i[t]||typeof i[t]=="boolean"||i[t]===0))}class $t{constructor(e){this.externalEntities={},this.options=ot(e)}parse(e,t){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=Ye(e,t);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const r=new Et(this.options);r.addExternalEntities(this.externalEntities);const s=r.parseXml(e);return this.options.preserveOrder||s===void 0?s:Ft(s,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}static getMetaDataSymbol(){return M.getMetaDataSymbol()}}class D{static async buildFromDefinitions(e,t){const r=new B;if(e.rootElements.length>0)for(const n of e.rootElements){if(n.$type=="bpmn:Process"){let o=new A(null,n.id);r.addObject(o)}if(n.hasOwnProperty("flowElements")&&n.flowElements.length>0)for(const o of n.flowElements)this.createFlowObjects(o,r);else if(n.hasOwnProperty("messageFlows")&&n.messageFlows.length>0)for(const o of n.messageFlows)if(o.$type=="bpmn:MessageFlow"){let u=new I("",o.id,"message",o.sourceRef.id,o.targetRef.id);r.addObject(u)}else console.info("Element cannot be added: "+o.id)}let s=await this.loadAndParseXMLSimulationData(t);return this.updateDiagramData(r,s),r}static updateDiagramData(e,t){e.getAllObjects().forEach(r=>{r instanceof I&&r.getType()==="message"&&this.addMessageConnections(e,r),r instanceof N?(this.createReferenceConnectionsFlowObj(e,r),this.processSimulationDataFlowElements(t,r)):r instanceof I?this.createReferenceConnectionsConnectingObj(e,r):r instanceof A&&this.processSimulationDataParticipants(r,t)}),this.processSimulationDataScenarioSpecs(t.simulation.scenariospecs,e),this.processSimulationDataTimetables(t.simulation.timetable,e),this.processSimulationDataNewParticipants(t.simulation.resource,e)}static addMessageConnections(e,t){e.getAllObjects().forEach(r=>{t.getTarget()==r.getID()?r.getIns().push(t.ID):t.getSource()==r.getID()&&r.getOuts().push(t.ID)})}static createReferenceConnectionsFlowObj(e,t){Array.isArray(t.getIns())&&t.getIns().length>0&&this.createReferenceConnectionsFlowObjIns(e,t),Array.isArray(t.getOuts())&&t.getOuts().length>0&&this.createReferenceConnectionsFlowObjOuts(e,t)}static createReferenceConnectionsFlowObjIns(e,t){let r=new Array;t.getIns().forEach(s=>{e.getAllObjects().forEach(n=>{n.getID()===s&&r.push(n)})}),t.setIns(r)}static createReferenceConnectionsFlowObjOuts(e,t){let r=new Array;t.getOuts().forEach(s=>{e.getAllObjects().forEach(n=>{n.getID()===s&&r.push(n)})}),t.setOuts(r)}static createReferenceConnectionsConnectingObj(e,t){this.createReferenceConnectionsConnectingObjSource(e,t),this.createReferenceConnectionsConnectingObjTarget(e,t)}static createReferenceConnectionsConnectingObjSource(e,t){let r;e.getAllObjects().forEach(s=>{s.getID()===t.getSource()&&(r=s)}),r&&t.setSource(r)}static createReferenceConnectionsConnectingObjTarget(e,t){let r;e.getAllObjects().forEach(s=>{s.getID()===t.getTarget()&&(r=s)}),r&&t.setTarget(r)}static createFlowObjects(e,t){let r,s=this.getIns(e),n=this.getOuts(e);e.$type=="bpmn:ExclusiveGateway"?r=new k(e.name,e.id,"Exclusive",s,n):e.$type=="bpmn:Task"?r=new w(e.name,e.id,s,n):e.$type=="bpmn:StartEvent"?r=new O(e.name,e.id,s,n,"start"):e.$type=="bpmn:EndEvent"?r=new O(e.name,e.id,s,n,"end"):e.$type=="bpmn:SequenceFlow"?r=new I(e.name,e.id,"sequence",e.sourceRef.id,e.targetRef.id):e.$type=="bpmn:DataObjectReference"?r=new R(e.name,e.id):e.$type=="bpmn:IntermediateCatchEvent"?r=this.addIntermediateCatchEvent(e,s,n):e.$type=="bpmn:DataObject"?r=new R(e.name,e.id):console.info("Element cannot be processed: "+e.id+", "+e.name),r&&t.addObject(r)}static addIntermediateCatchEvent(e,t,r){let s;if(e.eventDefinitions.length>0){const n=e.eventDefinitions[0].$type;n=="bpmn:TimerEventDefinition"?s=new _(e.name,e.id,t,r,"intermediate"):n=="bpmn:MessageEventDefinition"?s=new j(e.name,e.id,t,r,"intermediate"):console.log("This event cannot be added due to its type. Event: "+e)}return s}static getIns(e){let t=new Array;if(e.incoming&&typeof e.incoming[Symbol.iterator]=="function")for(const r of e.incoming)t.push(r.id);return t}static getOuts(e){let t=new Array;if(e.outgoing&&typeof e.outgoing[Symbol.iterator]=="function")for(const r of e.outgoing)t.push(r.id);return t}static async loadAndParseXMLSimulationData(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Error while loading file ${e}: ${t.statusText}`);const r=await t.text();return new $t().parse(r)}catch(t){console.error("Error while loading or parsing file ",e,":",t)}}static processSimulationDataFlowElements(e,t){if(!e||!e.simulation||!e.simulation.element)console.error("Invalid simulation data.");else{let r=e.simulation.element;Array.isArray(r)||(r=[r],e.simulation.element=r);const s=r.findIndex(n=>n.id==t.getID());if(s!==-1){const n=r.splice(s,1)[0];this.processSimulationDataOneFlowElement(n,t)}}}static processSimulationDataOneFlowElement(e,t){t instanceof w?(t.setResource(e.resource),t.setFixedCosts(e.fixedcost),t.setDistribution(e.distribution),t.setUnit(e.unit),t.setMean(e.mean),t.setStdDeviation(e.stddeviation)):t instanceof k&&e.type2=="Exlusive"?(Array.isArray(e.out)||(e.out=[e.out]),e.out.forEach(r=>{t.addProbability(r.id,r.probability)})):t instanceof O&&t.getType()=="intermediate"&&(t.setDistribution(e.distribution),t.setUnit(e.unit),t.setMean(e.mean),t.setStdDeviation(e.stddeviation))}static processSimulationDataScenarioSpecs(e,t){t.setArrivalDistribution(e.arrivaldistribution),t.setArrivalMean(e.arrivalmean),t.setArrivalStdDeviation(e.arrivalstddeviation),t.setArrivalUnit(e.arrivalunit),t.setNumberOfInstances(e.numberofinstances),t.setCurrency(e.currency);let[r,s]=e.starttime.split(" "),[n,o,u]=r.split("/").map(Number),[a,c]=s.split(":").map(Number),l=new Date(u,o-1,n,a,c);t.setStartTime(l)}static processSimulationDataTimetables(e,t){Array.isArray(e)||(e=[e]),e.forEach(r=>{let s=new F(r.name,this.convertDayToNumber(r.beginday),this.convertDayToNumber(r.endday),r.begintime,r.endtime);t.addTimetable(s)})}static convertDayToNumber(e){switch(e){case"Monday":return 1;case"Tuesday":return 2;case"Wednesday":return 3;case"Thursday":return 4;case"Friday":return 5;case"Saturday":return 6;case"Sunday":return 0;default:return 0}}static processSimulationDataParticipants(e,t){let r=t.simulation.resource;Array.isArray(r)||(r=[r],t.simulation.resource=r);const s=r.findIndex(n=>n.id==e.getID());if(s!==-1){const n=r.splice(s,1)[0];e.setCost(n.costperhour),e.setWorkingHours(n.timetable),e.setNumber(n.number),e.setDescription(n.name)}}static processSimulationDataNewParticipants(e,t){Array.isArray(e)||(e=[e]),e.forEach(r=>{let s=new A(r.name,r.id);s.setCost(r.costperhour),s.setWorkingHours(r.timetable),s.setNumber(r.number),t.addObject(s)})}}class B{constructor(){this.objects=[],this.arrivalDistribution,this.arrivalMean,this.arrivalStdDeviation,this.arrivalUnit,this.numberOfInstances,this.startTime,this.currency,this.timetables=[]}addObject(e){e instanceof x?this.objects.push(e):console.log("Cannot add this object to diagram: "+e)}getAllObjects(){return this.objects}getObjectByID(e){return this.objects.find(t=>t.getID()==e)||null}getObjectByDescription(e){return this.objects.find(t=>t.getDescription()==e)||null}addTimetable(e){e instanceof F&&this.timetables.push(e)}getAllTimetables(){return this.timetables}getTimetableByName(e){return this.timetables.find(t=>t.getName()==e)||null}setArrivalDistribution(e){this.arrivalDistribution=e}setArrivalMean(e){this.arrivalMean=e}setArrivalStdDeviation(e){this.arrivalStdDeviation=e}setArrivalUnit(e){this.arrivalUnit=e}setNumberOfInstances(e){this.numberOfInstances=e}setStartTime(e){this.startTime=e}setCurrency(e){this.currency=e}getArrivalDistribution(){return this.arrivalDistribution}getArrivalMean(){return this.arrivalMean}getArrivalStdDeviation(){return this.arrivalStdDeviation}getArrivalUnit(){return this.arrivalUnit}getNumberOfInstances(){return this.numberOfInstances}getStartTime(){return this.startTime}getCurrency(){return this.currency}toSerializableObject(){var e,t;return{arrivalDistribution:this.arrivalDistribution,arrivalMean:this.arrivalMean,arrivalStdDeviation:this.arrivalStdDeviation,arrivalUnit:this.arrivalUnit,numberOfInstances:this.numberOfInstances,startTime:((t=(e=this.startTime)==null?void 0:e.toISOString)==null?void 0:t.call(e))||this.startTime,currency:this.currency,timetables:this.timetables.map(r=>r.toSerializableObject()),objects:this.objects.map(r=>r.toSerializableObject())}}static fromSerializableObject(e){const t=new B;return t.setArrivalDistribution(e.arrivalDistribution),t.setArrivalMean(e.arrivalMean),t.setArrivalStdDeviation(e.arrivalStdDeviation),t.setArrivalUnit(e.arrivalUnit),t.setNumberOfInstances(e.numberOfInstances),t.setStartTime(new Date(e.startTime)),t.setCurrency(e.currency),e.timetables.forEach(r=>t.addTimetable(F.fromSerializableObject(r))),e.objects.forEach(r=>t.addObject(Ve(r))),t}createCopyForSimulation(){const e=B.fromSerializableObject(this.toSerializableObject());return e.getAllObjects().forEach(t=>{t instanceof I&&t.getType()==="message"&&D.addMessageConnections(e,t),t instanceof N?D.createReferenceConnectionsFlowObj(e,t):t instanceof I&&D.createReferenceConnectionsConnectingObj(e,t)}),e}}class zt{constructor(e){this.currentTime=0,this.simulatedTime=new Date(e.getStartTime()),this.resourcePools={},this.queueByResourceType={},this.log=[],this.startEvent,this.arrivals=[],this.diagram=e,this.sleepingItems=new Set,this.loadEngineDetailsFromDiagram(e)}loadEngineDetailsFromDiagram(e){e.getAllObjects().forEach(t=>{if(t instanceof A)for(let r=0;r<t.getNumber();r++)this.addResource(t,t.getDescription());else t instanceof O&&t.getType()=="start"&&(this.startEvent=t)})}generateArrivalTimes(e){let t=0,r;e.getArrivalDistribution()==="Fixed"?r=E.uniform(e.getArrivalMean(),e.getArrivalMean()):e.getArrivalDistribution()==="Normal"?r=E.normal(e.getArrivalMean(),e.getArrivalStdDeviation()):e.getArrivalDistribution()==="Exponential"&&(r=E.exponential(1/e.getArrivalMean()));for(let s=0;s<e.getNumberOfInstances();s++){let n;if(r){n=r();let o=this.convertToSeconds(e.getArrivalUnit(),Math.abs(n));t+=Math.floor(o),this.arrivals.push({time:t,instanceId:s})}}this.arrivals.sort()}convertToSeconds(e,t){switch(e.toLowerCase()){case"second":case"seconds":return t;case"minute":case"minutes":return t*60;case"hour":case"hours":return t*3600;case"day":case"days":return t*86400;case"week":case"weeks":return t*604800;default:throw new Error(`Unknown time unit: ${e}`)}}addResource(e,t){this.resourcePools[t]||(this.resourcePools[t]=[],this.queueByResourceType[t]=new pe({comparator:(r,s)=>r.priority-s.priority})),this.resourcePools[t].push(e)}addWorkItemToQueue(e,t,r){if(!this.queueByResourceType[t])throw new Error(`Queue for resource type '${t}' does not exist.`);let s=new H(r,e,this.currentTime);this.queueByResourceType[t].queue({task:s,priority:r})}async run(){for(this.generateArrivalTimes(this.diagram);this.hasTasks()||this.sleepingItems.size>0||this.arrivals.length>0;){for(;this.arrivals.length>0&&this.currentTime>=this.arrivals[0].time;){const e=this.arrivals.shift();let t=this.logEvent(this.startEvent,e.instanceId+1);this.handleTokenMovement(t)}for(const e of this.sleepingItems)(e.resource==="none"||this.isResourceCurrentlyWorking(e.resource))&&(e.task.lowerRemainingExecutionTime(),e.task.getRemainingExecutionTime()<1&&(e.resource!="none"&&this.resourcePools[e.resource.getDescription()].push(e.resource),this.endTask(e.task),this.sleepingItems.delete(e)));for(let e in this.queueByResourceType){const t=this.queueByResourceType[e],r=this.resourcePools[e];if(r.length>0&&this.isResourceCurrentlyWorking(r[0]))for(;r.length>0&&t.length>0;){const s=r.shift(),o=t.dequeue().task;o.setStartTime(this.currentTime),this.sleepingItems.add({task:o,resource:s})}}this.currentTime+=1,this.simulatedTime.setSeconds(this.simulatedTime.getSeconds()+1)}}isResourceCurrentlyWorking(e){let t=e.getWorkingHours(),r=this.diagram.getTimetableByName(t),s=this.simulatedTime.getDay();s==0&&(s=7);let n=r.getBeginDay()==0?7:r.getBeginDay(),o=r.getEndDay()==0?7:r.getEndDay();if(s>=n&&s<=o){let a=this.simulatedTime.getHours(),c=this.simulatedTime.getMinutes(),l=r.getBeginTime().split(":"),h=r.getEndTime().split(":");if((a>l[0]||a==l[0]&&c>=l[1])&&(a<h[0]||a==h[0]&&c<=h[1]))return!0}return!1}hasTasks(){for(let e in this.queueByResourceType)if(this.queueByResourceType[e].length>0)return!0;return!1}endTask(e){e.setCompletedTime(this.currentTime),this.log.push(e),this.handleTokenMovement(e)}handleTokenMovement(e){let t=e.getItem(),r=[];for(Array.isArray(t.getOuts())&&t.getOuts().length>0&&t.getOuts().forEach(s=>{r.push(s.target)});r.length>0;){let s=r.shift();if(s instanceof w)this.addWorkItemToQueue(s,s.getResource(),e.getInstanceID());else if(s instanceof _||s instanceof j){let n=new H(e.getInstanceID(),s,this.currentTime);this.sleepingItems.add({task:n,resource:"none"})}else if(s instanceof k){if(Array.isArray(s.getOuts())&&s.getOuts().length>0){let n=this.weightedRandomSelect(s.getProbabilities()),o=s.getOuts().find(u=>u.getID()===n);o&&r.push(o.target)}}else s instanceof O&&(Array.isArray(s.getOuts())&&s.getOuts().length>0&&s.getOuts().forEach(n=>{r.push(n.target)}),this.logEvent(s,e.getInstanceID()))}}logEvent(e,t){let r=new H(t,e,this.currentTime);return r.setStartTime(this.currentTime),r.setCompletedTime(this.currentTime),this.log.push(r),r}weightedRandomSelect(e){if(e.length>0){let t=e.reduce((n,o)=>n+o.probability,0),s=E.uniform(0,t)();for(const n of e){if(s<n.probability)return n.id;s-=n.weight}return e.at(-1).id}}}class Ut{static createStatistics(e,t){let r={};return r.general=this.generateGeneralStatistics(e,t),r.instances=this.generateInstanceStatistics(e,t),r.activites=this.generateActivityStatistics(e,t),r.resources=this.generateResourceUtilization(e,t,r.general),r}static generateGeneralStatistics(e,t){const r={numberOfInstances:t.getNumberOfInstances(),totalPrice:0,totalWarehouse:0,totalRealExecutionTime:0,totalWholeDuration:0,totalDuration:0,totalDurationWithoutOfftime:0,totalWaitingForExecution:0,efektivnost:0,efektivnost1:0};let s=0;for(const n of e){let o=n.getItem(),u=n.getReadyToBeExecuted(),a=n.getStartTime(),c=n.getCompletedTime(),l=n.executionTime??0;if(c>s&&(s=c),!(a===null||c===null)&&(r.totalWholeDuration+=c-u,r.totalDuration+=c-a,r.totalDurationWithoutOfftime+=l,r.totalWaitingForExecution+=a-u,o instanceof w)){const h=t.getObjectByDescription(o.getResource());if(h){const f=h.getCost()*(l/3600);r.totalPrice+=f}}}return r.totalWarehouse=this.generateWarehouseCost(t,s),r.totalRealExecutionTime=s,r.efektivnost=r.totalDuration/r.totalWholeDuration*100,r.efektivnost1=r.totalDurationWithoutOfftime/r.totalWholeDuration*100,r}static generateInstanceStatistics(e,t){const r=new Map;for(const n of e){let o=n.getInstanceID(),u=n.getItem(),a=n.getReadyToBeExecuted(),c=n.getStartTime(),l=n.getCompletedTime(),h=n.executionTime??0;if(c===null||l===null)continue;r.has(o)||r.set(o,{name:o,totalPrice:0,totalWholeDuration:0,totalDuration:0,totalDurationWithoutOfftime:0,totalWaitingForExecution:0});const f=r.get(o);if(f.totalWholeDuration+=l-a,f.totalDuration+=l-c,f.totalDurationWithoutOfftime+=h,f.totalWaitingForExecution+=c-a,u instanceof w){const g=t.getObjectByDescription(u.getResource());if(g){const d=g.getCost()*(h/3600);f.totalPrice+=d}}}return{instances:r,minPrice:Math.min(...Array.from(r.values(),n=>n.totalPrice)),avgPrice:[...r.values()].reduce((n,o)=>n+o.totalPrice,0)/t.getNumberOfInstances(),maxPrice:Math.max(...Array.from(r.values(),n=>n.totalPrice)),minWholeDuration:Math.min(...Array.from(r.values(),n=>n.totalWholeDuration)),avgWholeDuration:[...r.values()].reduce((n,o)=>n+o.totalWholeDuration,0)/t.getNumberOfInstances(),maxWholeDuration:Math.max(...Array.from(r.values(),n=>n.totalWholeDuration)),minDuration:Math.min(...Array.from(r.values(),n=>n.totalDuration)),avgDuration:[...r.values()].reduce((n,o)=>n+o.totalDuration,0)/t.getNumberOfInstances(),maxDuration:Math.max(...Array.from(r.values(),n=>n.totalDuration)),minDurationWithoutOfftime:Math.min(...Array.from(r.values(),n=>n.totalDurationWithoutOfftime)),avgDurationWithoutOfftime:[...r.values()].reduce((n,o)=>n+o.totalDurationWithoutOfftime,0)/t.getNumberOfInstances(),maxDurationWithoutOfftime:Math.max(...Array.from(r.values(),n=>n.totalDurationWithoutOfftime)),minWaitingForExecution:Math.min(...Array.from(r.values(),n=>n.totalWaitingForExecution)),avgWaitingForExecution:[...r.values()].reduce((n,o)=>n+o.totalWaitingForExecution,0)/t.getNumberOfInstances(),maxWaitingForExecution:Math.max(...Array.from(r.values(),n=>n.totalWaitingForExecution))}}static generateActivityStatistics(e,t){const r={};for(const n of e){let o=n.getItem(),u=o.getID(),a=n.getReadyToBeExecuted(),c=n.getStartTime(),l=n.getCompletedTime(),h=n.getExecutionTime();if(c===null||l===null)continue;let f;o instanceof w?f=t.getObjectByDescription(o.getResource()).getCost()*(h/3600):f=0,r[u]||(r[u]={name:o.getDescription(),wholeDuration:[],duration:[],durationWithoutOfftime:[],waitingForExecution:[],prices:[],instances:new Set}),r[u].wholeDuration.push(l-a),r[u].duration.push(l-c),r[u].durationWithoutOfftime.push(h??0),r[u].waitingForExecution.push(c-a),r[u].prices.push(f),r[u].instances.add(n.getInstanceID())}const s={};for(const[n,o]of Object.entries(r))s[n]={name:o.name,count:o.duration.length,percInstances:o.instances.size/t.getNumberOfInstances()*100,minWholeDuration:Math.min(...o.wholeDuration),maxWholeDuration:Math.max(...o.wholeDuration),avgWholeDuration:o.wholeDuration.reduce((u,a)=>u+a,0)/o.wholeDuration.length,minDuration:Math.min(...o.duration),maxDuration:Math.max(...o.duration),avgDuration:o.duration.reduce((u,a)=>u+a,0)/o.duration.length,minDurationWithoutOfftime:Math.min(...o.durationWithoutOfftime),maxDurationWithoutOfftime:Math.max(...o.durationWithoutOfftime),avgDurationWithoutOfftime:o.durationWithoutOfftime.reduce((u,a)=>u+a,0)/o.durationWithoutOfftime.length,minWaitingForExecution:Math.min(...o.waitingForExecution),maxWaitingForExecution:Math.max(...o.waitingForExecution),avgWaitingForExecution:o.waitingForExecution.reduce((u,a)=>u+a,0)/o.waitingForExecution.length,minPrice:Math.min(...o.prices),maxPrice:Math.max(...o.prices),avgPrice:o.prices.reduce((u,a)=>u+a,0)/o.prices.length};return s}static countWorktimeForResource(e,t,r){let s=[];const n=e.getStartTime();let o=n.getDay()==0?7:n.getDay(),u=n.getHours(),a=n.getMinutes(),c=r.totalRealExecutionTime,l=t.getBeginTime().split(":").map(Number),h=t.getEndTime().split(":").map(Number),f=h[0]*60*60+h[1]*60-(l[0]*60*60+l[1]*60),g=t.getBeginDay()==0?7:t.getBeginDay(),d=t.getEndDay()==0?7:t.getEndDay();for(;c>0;){if(o>=g&&o<=d)if((u>l[0]||u==l[0]&&a>=l[1])&&(u<h[0]||u==h[0]&&a<=h[1])){let b=86400-(u*60*60+a*60),S=f-(u*60*60+a*60-(l[0]*60*60+l[1]*60));c>=b||c>=S?s.push(S):s.push(c),c-=b,u=0,a=0}else if(u<l[0]||u==l[0]&&a<l[1]){let b=86400-(u*60*60+a*60),S=l[0]*60*60+l[1]*60;c<=S?(c-=b,u=0,a=0):c<=S+f?(s.push(c-S),c-=b,u=0,a=0):(s.push(f),c-=b,u=0,a=0)}else{let b=86400-(u*60*60+a*60);c-=b,u=0,a=0}else{let b=86400-(u*60*60+a*60);c-=b,u=0,a=0}o=o+1==8?1:o+1}return s.reduce((p,b)=>p+b,0)}static generateResourceUtilization(e,t,r){const s={},n=t.getAllObjects().filter(o=>o instanceof A&&o.number>0);for(const o of n){let u=this.countWorktimeForResource(t,t.getTimetableByName(o.getWorkingHours()),r);s[o.getID()]={id:o.getID(),name:o.getDescription(),count:o.getNumber(),oneShiftsLenght:u,allShiftsLenght:u*o.getNumber(),workedTime:0}}for(const o of e){let u=o.getItem();if(u instanceof w){let a=t.getObjectByDescription(u.getResource()),c=o.getExecutionTime();s[a.getID()].workedTime+=c}}return s}static formatCzechUnit(e,t){return e<=1?t[0]:e>=2&&e<=4?t[1]:t[2]}static prepareValueForReading(e){if(e==null||e<=0)return"0 sekund";const t=[],r=[{seconds:60*60*24*7,name:["týden","týdny","týdnů"]},{seconds:60*60*24,name:["den","dny","dní"]},{seconds:60*60,name:["hodina","hodiny","hodin"]},{seconds:60,name:["minuta","minuty","minut"]},{seconds:1,name:["sekunda","sekundy","sekund"]}];for(const n of r){const o=Math.floor(e/n.seconds);o>0&&(t.push({count:o,name:this.formatCzechUnit(o,n.name)}),e-=o*n.seconds)}return t.slice(0,2).map(n=>`${n.count} ${n.name}`).join(" ")}static convertGeneralDescriptions(e){switch(e){case"numberOfInstances":return"Celkový počet instancí: ";case"totalPrice":return"Celková cena: ";case"totalRealExecutionTime":return"Reálná doba provádění: ";case"totalWholeDuration":return"Celkový běh simulace: ";case"totalDuration":return"Celkový čas provádění úloh: ";case"totalDurationWithoutOfftime":return"Celkový čas provádění úloh v pracovní době: ";case"totalWaitingForExecution":return"Celkový čas čekání: ";case"efektivnost":return"Efektivita procesu: ";case"efektivnost1":return"Efektivita procesu (v pracovní době): ";default:return e}}static convertGeneralValues(e,t,r){switch(e){case"totalPrice":return r.getCurrency()=="CZK"?new Intl.NumberFormat("cs-CZ",{style:"currency",currency:"CZK",maximumFractionDigits:0,minimumFractionDigits:0}).format(t):t.toFixed(2)+r.getCurrency();case"totalRealExecutionTime":case"totalWholeDuration":case"totalDuration":case"totalDurationWithoutOfftime":case"totalWaitingForExecution":return this.prepareValueForReading(t);case"efektivnost":case"efektivnost1":return t.toFixed(2)+" %";default:return t}}static convertInstancesValues(e,t,r){switch(e){case"minPrice":case"avgPrice":case"maxPrice":return t.toFixed(2)+" "+r.getCurrency();case"minWholeDuration":case"avgWholeDuration":case"maxWholeDuration":case"minDuration":case"avgDuration":case"maxDuration":case"minDurationWithoutOfftime":case"avgDurationWithoutOfftime":case"maxDurationWithoutOfftime":case"minWaitingForExecution":case"avgWaitingForExecution":case"maxWaitingForExecution":return this.prepareValueForReading(t);default:return t}}static generateWarehouseCost(e,t){const r=e.getObjectByID("Gateway_VseNaskladneno");if(r){const s=r.getProbabilities().find(o=>o.id==="Flow_VseNaskladneno_OpravitAutomobil"),n=t/(3600*7*24*4);if(s)return s.probability>=.65?(E.exponential(14285714285714285e-21)()+30001)*n:s.probability<=.35?E.int(3e3,1e4)*n:E.int(10001,3e4)*n}return null}}self.onmessage=async i=>{const{diagramData:e}=i.data;try{const t=B.fromSerializableObject(e);t.getAllObjects().forEach(n=>{n instanceof I&&n.getType()==="message"&&D.addMessageConnections(t,n),n instanceof N?D.createReferenceConnectionsFlowObj(t,n):n instanceof I&&D.createReferenceConnectionsConnectingObj(t,n)});const r=new zt(t);await r.run();const s=Ut.createStatistics(r.log,t);self.postMessage({log:r.log,stats:s})}catch(t){self.postMessage({error:t.message})}}})();
